<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>moc_base: lib/MOC/Sanitize.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_dd14fbbbdaa65b229b5565dd5e32e554.html">lib</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a31528689d76d5b04db586865b43700e.html">MOC</a></div>
<h1>Sanitize.php</h1><a href="Sanitize_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00014"></a><a class="code" href="classMOC__Sanitize.html">00014</a> <span class="keyword">class </span><a class="code" href="classMOC__Sanitize.html">MOC_Sanitize</a> {
<a name="l00023"></a><a class="code" href="classMOC__Sanitize.html#5d4487067e8176779de188fddae1a72a">00023</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classMOC__Sanitize.html#5d4487067e8176779de188fddae1a72a">paranoid</a>($string, $allowed = array()) {
<a name="l00024"></a>00024                 $allow = null;
<a name="l00025"></a>00025                 <span class="keywordflow">if</span> (!empty($allowed)) {
<a name="l00026"></a>00026                         foreach ($allowed as $value) {
<a name="l00027"></a>00027                                 $allow .= <span class="stringliteral">"\\$value"</span>;
<a name="l00028"></a>00028                         }
<a name="l00029"></a>00029                 }
<a name="l00030"></a>00030 
<a name="l00031"></a>00031                 <span class="keywordflow">if</span> (is_array($string)) {
<a name="l00032"></a>00032                         $cleaned = array();
<a name="l00033"></a>00033                         foreach ($string as $key =&gt; $clean) {
<a name="l00034"></a>00034                                 $cleaned[$key] = preg_replace(<span class="stringliteral">"/[^{$allow}a-zA-Z0-9]/"</span>, '', $clean);
<a name="l00035"></a>00035                         }
<a name="l00036"></a>00036                 } <span class="keywordflow">else</span> {
<a name="l00037"></a>00037                         $cleaned = preg_replace(<span class="stringliteral">"/[^{$allow}a-zA-Z0-9]/"</span>, '', $string);
<a name="l00038"></a>00038                 }
<a name="l00039"></a>00039                 <span class="keywordflow">return</span> $cleaned;
<a name="l00040"></a>00040         }
<a name="l00041"></a>00041     
<a name="l00051"></a><a class="code" href="classMOC__Sanitize.html#af69c752001787b3cc470e5eb36198f5">00051</a>         <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classMOC__Sanitize.html#af69c752001787b3cc470e5eb36198f5">html</a>($string, $remove = <span class="keyword">false</span>) {
<a name="l00052"></a>00052                 <span class="keywordflow">if</span> ($remove) {
<a name="l00053"></a>00053                         $string = strip_tags($string);
<a name="l00054"></a>00054                 } <span class="keywordflow">else</span> {
<a name="l00055"></a>00055                         $patterns = array(<span class="stringliteral">"/\&amp;/"</span>, <span class="stringliteral">"/%/"</span>, <span class="stringliteral">"/&lt;/"</span>, <span class="stringliteral">"/&gt;/"</span>, '/<span class="stringliteral">"/', "</span>/'/<span class="stringliteral">", "</span>/\(/<span class="stringliteral">", "</span>/\)/<span class="stringliteral">", "</span>/\+/<span class="stringliteral">", "</span>/-/<span class="stringliteral">");</span>
<a name="l00056"></a>00056 <span class="stringliteral">                        $replacements = array("</span>&amp;amp;<span class="stringliteral">", "</span>&amp;#37;<span class="stringliteral">", "</span>&amp;lt;<span class="stringliteral">", "</span>&amp;gt;<span class="stringliteral">", "</span>&amp;quot;<span class="stringliteral">", "</span>&amp;#39;<span class="stringliteral">", "</span>&amp;#40;<span class="stringliteral">", "</span>&amp;#41;<span class="stringliteral">", "</span>&amp;#43;<span class="stringliteral">", "</span>&amp;#45;<span class="stringliteral">");</span>
<a name="l00057"></a>00057 <span class="stringliteral">                        $string = preg_replace($patterns, $replacements, $string);</span>
<a name="l00058"></a>00058 <span class="stringliteral">                }</span>
<a name="l00059"></a>00059 <span class="stringliteral">                return $string;</span>
<a name="l00060"></a>00060 <span class="stringliteral">        }</span>
<a name="l00061"></a>00061 <span class="stringliteral">    </span>
<a name="l00070"></a><a class="code" href="classMOC__Sanitize.html#085b8b2405a0951b784a39273dca7594">00070</a> <span class="stringliteral">        public static function stripWhitespace($str) {</span>
<a name="l00071"></a>00071 <span class="stringliteral">                $r = preg_replace('/[\n\r\t]+/', '', $str);</span>
<a name="l00072"></a>00072 <span class="stringliteral">                return preg_replace('/\s{2,}/', ' ', $r);</span>
<a name="l00073"></a>00073 <span class="stringliteral">        }</span>
<a name="l00074"></a>00074 <span class="stringliteral">    </span>
<a name="l00083"></a><a class="code" href="classMOC__Sanitize.html#fc9089f56db2cb32d2f0da6186abd6e9">00083</a> <span class="stringliteral">        public static function stripImages($str) {</span>
<a name="l00084"></a>00084 <span class="stringliteral">                $str = preg_replace('/(&lt;a[^&gt;]*&gt;)(&lt;img[^&gt;]+alt="</span>)([^<span class="stringliteral">"]*)("</span>[^&gt;]*&gt;)(&lt;\/a&gt;)/i', '$1$3$5&lt;br /&gt;', $str);
<a name="l00085"></a>00085                 $str = preg_replace('/(&lt;img[^&gt;]+alt=<span class="stringliteral">")([^"</span>]*)(<span class="stringliteral">"[^&gt;]*&gt;)/i', '$2&lt;br /&gt;', $str);</span>
<a name="l00086"></a>00086 <span class="stringliteral">                $str = preg_replace('/&lt;img[^&gt;]*&gt;/i', '', $str);</span>
<a name="l00087"></a>00087 <span class="stringliteral">                return $str;</span>
<a name="l00088"></a>00088 <span class="stringliteral">        }</span>
<a name="l00089"></a>00089 <span class="stringliteral">    </span>
<a name="l00098"></a><a class="code" href="classMOC__Sanitize.html#49a06beaf602988c4eb09eb5248f5641">00098</a> <span class="stringliteral">        public static function stripScripts($str) {</span>
<a name="l00099"></a>00099 <span class="stringliteral">                return preg_replace('/(&lt;link[^&gt;]+rel="</span>[^<span class="stringliteral">"]*stylesheet"</span>[^&gt;]*&gt;|&lt;img[^&gt;]*&gt;|style=<span class="stringliteral">"[^"</span>]*<span class="stringliteral">")|&lt;script[^&gt;]*&gt;.*?&lt;\/script&gt;|&lt;style[^&gt;]*&gt;.*?&lt;\/style&gt;|&lt;!--.*?--&gt;/i', '', $str);</span>
<a name="l00100"></a>00100 <span class="stringliteral">        }</span>
<a name="l00101"></a>00101 <span class="stringliteral">    </span>
<a name="l00109"></a><a class="code" href="classMOC__Sanitize.html#f5eb40ca315d3aaca061295a4e02e2ee">00109</a> <span class="stringliteral">        public static function stripAll($str) {</span>
<a name="l00110"></a>00110 <span class="stringliteral">                $str = self::stripWhitespace($str);</span>
<a name="l00111"></a>00111 <span class="stringliteral">                $str = self::stripImages($str);</span>
<a name="l00112"></a>00112 <span class="stringliteral">                $str = self::stripScripts($str);</span>
<a name="l00113"></a>00113 <span class="stringliteral">                return $str;</span>
<a name="l00114"></a>00114 <span class="stringliteral">        }</span>
<a name="l00115"></a>00115 <span class="stringliteral">    </span>
<a name="l00126"></a><a class="code" href="classMOC__Sanitize.html#455380ae54530b305e6935dae4802d52">00126</a> <span class="stringliteral">        public static function stripTags() {</span>
<a name="l00127"></a>00127 <span class="stringliteral">                $params = params(func_get_args());</span>
<a name="l00128"></a>00128 <span class="stringliteral">                $str = $params[0];</span>
<a name="l00129"></a>00129 <span class="stringliteral"></span>
<a name="l00130"></a>00130 <span class="stringliteral">                for ($i = 1; $i &lt; count($params); $i++) {</span>
<a name="l00131"></a>00131 <span class="stringliteral">                        $str = preg_replace('/&lt;' . $params[$i] . '\b[^&gt;]*&gt;/i', '', $str);</span>
<a name="l00132"></a>00132 <span class="stringliteral">                        $str = preg_replace('/&lt;\/' . $params[$i] . '[^&gt;]*&gt;/i', '', $str);</span>
<a name="l00133"></a>00133 <span class="stringliteral">                }</span>
<a name="l00134"></a>00134 <span class="stringliteral">                return $str;</span>
<a name="l00135"></a>00135 <span class="stringliteral">        }</span>
<a name="l00136"></a>00136 <span class="stringliteral">    </span>
<a name="l00148"></a><a class="code" href="classMOC__Sanitize.html#6f4ed4b26b74f4ea1105649450e23ccd">00148</a> <span class="stringliteral">        public static function clean($data, $options = array()) {</span>
<a name="l00149"></a>00149 <span class="stringliteral">                if (empty($data)) {</span>
<a name="l00150"></a>00150 <span class="stringliteral">                        return $data;</span>
<a name="l00151"></a>00151 <span class="stringliteral">                }</span>
<a name="l00152"></a>00152 <span class="stringliteral"></span>
<a name="l00153"></a>00153 <span class="stringliteral">        if (!is_array($options)) {</span>
<a name="l00154"></a>00154 <span class="stringliteral">                        $options = array();</span>
<a name="l00155"></a>00155 <span class="stringliteral">                }</span>
<a name="l00156"></a>00156 <span class="stringliteral"></span>
<a name="l00157"></a>00157 <span class="stringliteral">                $options = array_merge(array(</span>
<a name="l00158"></a>00158 <span class="stringliteral">                        'odd_spaces' =&gt; true,</span>
<a name="l00159"></a>00159 <span class="stringliteral">                        'encode' =&gt; true,</span>
<a name="l00160"></a>00160 <span class="stringliteral">                        'dollar' =&gt; true,</span>
<a name="l00161"></a>00161 <span class="stringliteral">                        'carriage' =&gt; true,</span>
<a name="l00162"></a>00162 <span class="stringliteral">                        'unicode' =&gt; true,</span>
<a name="l00163"></a>00163 <span class="stringliteral">                        'escape' =&gt; true,</span>
<a name="l00164"></a>00164 <span class="stringliteral">                        'backslash' =&gt; true</span>
<a name="l00165"></a>00165 <span class="stringliteral">                ), $options);</span>
<a name="l00166"></a>00166 <span class="stringliteral"></span>
<a name="l00167"></a>00167 <span class="stringliteral">                if (is_array($data)) {</span>
<a name="l00168"></a>00168 <span class="stringliteral">                        foreach ($data as $key =&gt; $val) {</span>
<a name="l00169"></a>00169 <span class="stringliteral">                                $data[$key] = self::clean($val, $options);</span>
<a name="l00170"></a>00170 <span class="stringliteral">                        }</span>
<a name="l00171"></a>00171 <span class="stringliteral">                        return $data;</span>
<a name="l00172"></a>00172 <span class="stringliteral">                } else {</span>
<a name="l00173"></a>00173 <span class="stringliteral">                        if ($options['odd_spaces']) {</span>
<a name="l00174"></a>00174 <span class="stringliteral">                                $data = str_replace(chr(0xCA), '', str_replace(' ', ' ', $data));</span>
<a name="l00175"></a>00175 <span class="stringliteral">                        }</span>
<a name="l00176"></a>00176 <span class="stringliteral">                        if ($options['encode']) {</span>
<a name="l00177"></a>00177 <span class="stringliteral">                                $data = self::html($data);</span>
<a name="l00178"></a>00178 <span class="stringliteral">                        }</span>
<a name="l00179"></a>00179 <span class="stringliteral">                        if ($options['dollar']) {</span>
<a name="l00180"></a>00180 <span class="stringliteral">                                $data = str_replace("</span>\\\$<span class="stringliteral">", "</span>$<span class="stringliteral">", $data);</span>
<a name="l00181"></a>00181 <span class="stringliteral">                        }</span>
<a name="l00182"></a>00182 <span class="stringliteral">                        if ($options['carriage']) {</span>
<a name="l00183"></a>00183 <span class="stringliteral">                                $data = str_replace("</span>\r<span class="stringliteral">", "</span><span class="stringliteral">", $data);</span>
<a name="l00184"></a>00184 <span class="stringliteral">                        }</span>
<a name="l00185"></a>00185 <span class="stringliteral"></span>
<a name="l00186"></a>00186 <span class="stringliteral">                        $data = str_replace("</span>'<span class="stringliteral">", "</span>'<span class="stringliteral">", str_replace("</span>!<span class="stringliteral">", "</span>!<span class="stringliteral">", $data));</span>
<a name="l00187"></a>00187 <span class="stringliteral"></span>
<a name="l00188"></a>00188 <span class="stringliteral">                        if ($options['unicode']) {</span>
<a name="l00189"></a>00189 <span class="stringliteral">                                $data = preg_replace("</span>/&amp;amp;#([0-9]+);/s<span class="stringliteral">", "</span>&amp;#\\1;<span class="stringliteral">", $data);</span>
<a name="l00190"></a>00190 <span class="stringliteral">                        }</span>
<a name="l00191"></a>00191 <span class="stringliteral">                        if ($options['backslash']) {</span>
<a name="l00192"></a>00192 <span class="stringliteral">                                $data = preg_replace("</span>/\\\(?!&amp;amp;#|\?#)/<span class="stringliteral">", "</span>\\<span class="stringliteral">", $data);</span>
<a name="l00193"></a>00193 <span class="stringliteral">                        }</span>
<a name="l00194"></a>00194 <span class="stringliteral">                        return $data;</span>
<a name="l00195"></a>00195 <span class="stringliteral">                }</span>
<a name="l00196"></a>00196 <span class="stringliteral">        }</span>
<a name="l00197"></a>00197 <span class="stringliteral">}</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jan 21 14:53:13 2010 for moc_base by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
