<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>moc_base: lib/Zend/Config/Writer/Ini.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_dd14fbbbdaa65b229b5565dd5e32e554.html">lib</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_b2615ac6192da3805249bdead084c76e.html">Zend</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_8fd4287eede9c469d30ac2c90ffc0c03.html">Config</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_c0e4b3bf8b9cf707be8b0c051acc083e.html">Writer</a></div>
<h1>Ini.php</h1><a href="Zend_2Config_2Writer_2Ini_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00025"></a>00025 require_once 'Zend/Config/Writer.php';
<a name="l00026"></a>00026 
<a name="l00033"></a><a class="code" href="classZend__Config__Writer__Ini.html">00033</a> <span class="keyword">class </span><a class="code" href="classZend__Config__Writer__Ini.html">Zend_Config_Writer_Ini</a> <span class="keyword">extends</span> <a class="code" href="classZend__Config__Writer.html">Zend_Config_Writer</a>
<a name="l00034"></a>00034 {
<a name="l00040"></a><a class="code" href="classZend__Config__Writer__Ini.html#4c0ec09958567d52d02509ff4c3e8578">00040</a>     <span class="keyword">protected</span> <a class="code" href="classZend__Config__Writer__Ini.html#4c0ec09958567d52d02509ff4c3e8578">$_filename</a> = null;
<a name="l00041"></a>00041 
<a name="l00047"></a><a class="code" href="classZend__Config__Writer__Ini.html#d41dbfbbeae3f43967506ce32a0fa41b">00047</a>     <span class="keyword">protected</span> <a class="code" href="classZend__Config__Writer__Ini.html#d41dbfbbeae3f43967506ce32a0fa41b">$_exclusiveLock</a> = <span class="keyword">false</span>;
<a name="l00048"></a>00048 
<a name="l00054"></a><a class="code" href="classZend__Config__Writer__Ini.html#735e33b1e9a3abd8b1c6e9c15f8ce659">00054</a>     <span class="keyword">protected</span> <a class="code" href="classZend__Config__Writer__Ini.html#735e33b1e9a3abd8b1c6e9c15f8ce659">$_nestSeparator</a> = <span class="charliteral">'.'</span>;
<a name="l00055"></a>00055 
<a name="l00062"></a><a class="code" href="classZend__Config__Writer__Ini.html#7a7b6c65a9e8af496f22a95d1b84156e">00062</a>     <span class="keyword">public</span> function <a class="code" href="classZend__Config__Writer__Ini.html#7a7b6c65a9e8af496f22a95d1b84156e">setFilename</a>($filename)
<a name="l00063"></a>00063     {
<a name="l00064"></a>00064         $this-&gt;_filename = $filename;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066         <span class="keywordflow">return</span> $this;
<a name="l00067"></a>00067     }
<a name="l00068"></a>00068 
<a name="l00075"></a><a class="code" href="classZend__Config__Writer__Ini.html#027489239e7180b94d69cfb0e7c89109">00075</a>     <span class="keyword">public</span> function <a class="code" href="classZend__Config__Writer__Ini.html#027489239e7180b94d69cfb0e7c89109">setExclusiveLock</a>($exclusiveLock)
<a name="l00076"></a>00076     {
<a name="l00077"></a>00077         $this-&gt;_exclusiveLock = $exclusiveLock;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <span class="keywordflow">return</span> $this;
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081 
<a name="l00088"></a><a class="code" href="classZend__Config__Writer__Ini.html#b1aef81029fdca9706b35fde689ab770">00088</a>     <span class="keyword">public</span> function <a class="code" href="classZend__Config__Writer__Ini.html#b1aef81029fdca9706b35fde689ab770">setNestSeparator</a>($separator)
<a name="l00089"></a>00089     {
<a name="l00090"></a>00090         $this-&gt;_nestSeparator = $separator;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         <span class="keywordflow">return</span> $this;
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094 
<a name="l00105"></a><a class="code" href="classZend__Config__Writer__Ini.html#75d58c38e328ea90c1f110650d4beba9">00105</a>     <span class="keyword">public</span> function <a class="code" href="classZend__Config__Writer.html#3fea754e04be238148a4297c9c74e1f4">write</a>($filename = null, <a class="code" href="classZend__Config.html">Zend_Config</a> $config = null, $exclusiveLock = null)
<a name="l00106"></a>00106     {
<a name="l00107"></a>00107         <span class="keywordflow">if</span> ($filename !== null) {
<a name="l00108"></a>00108             $this-&gt;<a class="code" href="classZend__Config__Writer__Ini.html#7a7b6c65a9e8af496f22a95d1b84156e">setFilename</a>($filename);
<a name="l00109"></a>00109         }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         <span class="keywordflow">if</span> ($config !== null) {
<a name="l00112"></a>00112             $this-&gt;<a class="code" href="classZend__Config__Writer.html#e6b1ed288ac24112617e48c7a27a193f">setConfig</a>($config);
<a name="l00113"></a>00113         }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115         <span class="keywordflow">if</span> ($exclusiveLock !== null) {
<a name="l00116"></a>00116             $this-&gt;<a class="code" href="classZend__Config__Writer__Ini.html#027489239e7180b94d69cfb0e7c89109">setExclusiveLock</a>($exclusiveLock);
<a name="l00117"></a>00117         }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119         <span class="keywordflow">if</span> ($this-&gt;_filename === null) {
<a name="l00120"></a>00120             require_once 'Zend/Config/Exception.php';
<a name="l00121"></a>00121             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classZend__Config__Exception.html">Zend_Config_Exception</a>('No filename was set');
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         <span class="keywordflow">if</span> ($this-&gt;_config === null) {
<a name="l00125"></a>00125             require_once 'Zend/Config/Exception.php';
<a name="l00126"></a>00126             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classZend__Config__Exception.html">Zend_Config_Exception</a>('No config was set');
<a name="l00127"></a>00127         }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129         $iniString   = '';
<a name="l00130"></a>00130         $extends     = $this-&gt;_config-&gt;getExtends();
<a name="l00131"></a>00131         $sectionName = $this-&gt;_config-&gt;getSectionName();
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="keywordflow">if</span> (is_string($sectionName)) {
<a name="l00134"></a>00134             $iniString .= <span class="charliteral">'['</span> . $sectionName . <span class="charliteral">']'</span> . <span class="stringliteral">"\n"</span>
<a name="l00135"></a>00135                        .  $this-&gt;<a class="code" href="classZend__Config__Writer__Ini.html#ccf6e753caa1738328194bffe2c34259">_addBranch</a>($this-&gt;_config)
<a name="l00136"></a>00136                        .  <span class="stringliteral">"\n"</span>;
<a name="l00137"></a>00137         } <span class="keywordflow">else</span> {
<a name="l00138"></a>00138             foreach ($this-&gt;_config as $sectionName =&gt; $data) {
<a name="l00139"></a>00139                 <span class="keywordflow">if</span> (!($data instanceof <a class="code" href="classZend__Config.html">Zend_Config</a>)) {
<a name="l00140"></a>00140                     $iniString .= $sectionName
<a name="l00141"></a>00141                                .  ' = '
<a name="l00142"></a>00142                                .  $this-&gt;<a class="code" href="classZend__Config__Writer__Ini.html#1aa797f37be0f5cddd95fb690df59f6c">_prepareValue</a>($data)
<a name="l00143"></a>00143                                .  <span class="stringliteral">"\n"</span>;
<a name="l00144"></a>00144                 } <span class="keywordflow">else</span> {
<a name="l00145"></a>00145                     <span class="keywordflow">if</span> (isset($extends[$sectionName])) {
<a name="l00146"></a>00146                         $sectionName .= ' : ' . $extends[$sectionName];
<a name="l00147"></a>00147                     }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149                     $iniString .= <span class="charliteral">'['</span> . $sectionName . <span class="charliteral">']'</span> . <span class="stringliteral">"\n"</span>
<a name="l00150"></a>00150                                .  $this-&gt;<a class="code" href="classZend__Config__Writer__Ini.html#ccf6e753caa1738328194bffe2c34259">_addBranch</a>($data)
<a name="l00151"></a>00151                                .  <span class="stringliteral">"\n"</span>;
<a name="l00152"></a>00152                 }
<a name="l00153"></a>00153             }
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         $flags = 0;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <span class="keywordflow">if</span> ($this-&gt;_exclusiveLock) {
<a name="l00159"></a>00159             $flags |= LOCK_EX;
<a name="l00160"></a>00160         }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162         $result = @file_put_contents($this-&gt;_filename, $iniString, $flags);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <span class="keywordflow">if</span> ($result === <span class="keyword">false</span>) {
<a name="l00165"></a>00165             require_once 'Zend/Config/Exception.php';
<a name="l00166"></a>00166             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classZend__Config__Exception.html">Zend_Config_Exception</a>('Could not <a class="code" href="classZend__Config__Writer.html#3fea754e04be238148a4297c9c74e1f4">write</a> to file <span class="stringliteral">"' . $this-&gt;_filename . '"</span>');
<a name="l00167"></a>00167         }
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169 
<a name="l00176"></a><a class="code" href="classZend__Config__Writer__Ini.html#ccf6e753caa1738328194bffe2c34259">00176</a>     <span class="keyword">protected</span> function <a class="code" href="classZend__Config__Writer__Ini.html#ccf6e753caa1738328194bffe2c34259">_addBranch</a>(<a class="code" href="classZend__Config.html">Zend_Config</a> $config, $parents = array())
<a name="l00177"></a>00177     {
<a name="l00178"></a>00178         $iniString = '';
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         foreach ($config as $key =&gt; $value) {
<a name="l00181"></a>00181             $group = array_merge($parents, array($key));
<a name="l00182"></a>00182 
<a name="l00183"></a>00183             <span class="keywordflow">if</span> ($value instanceof <a class="code" href="classZend__Config.html">Zend_Config</a>) {
<a name="l00184"></a>00184                 $iniString .= $this-&gt;<a class="code" href="classZend__Config__Writer__Ini.html#ccf6e753caa1738328194bffe2c34259">_addBranch</a>($value, $group);
<a name="l00185"></a>00185             } <span class="keywordflow">else</span> {
<a name="l00186"></a>00186                 $iniString .= implode($this-&gt;_nestSeparator, $group)
<a name="l00187"></a>00187                            .  ' = '
<a name="l00188"></a>00188                            .  $this-&gt;<a class="code" href="classZend__Config__Writer__Ini.html#1aa797f37be0f5cddd95fb690df59f6c">_prepareValue</a>($value)
<a name="l00189"></a>00189                            .  <span class="stringliteral">"\n"</span>;
<a name="l00190"></a>00190             }
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         <span class="keywordflow">return</span> $iniString;
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195 
<a name="l00202"></a><a class="code" href="classZend__Config__Writer__Ini.html#1aa797f37be0f5cddd95fb690df59f6c">00202</a>     <span class="keyword">protected</span> function <a class="code" href="classZend__Config__Writer__Ini.html#1aa797f37be0f5cddd95fb690df59f6c">_prepareValue</a>($value)
<a name="l00203"></a>00203     {
<a name="l00204"></a>00204         <span class="keywordflow">if</span> (is_integer($value) || is_float($value)) {
<a name="l00205"></a>00205             <span class="keywordflow">return</span> $value;
<a name="l00206"></a>00206         } elseif (is_bool($value)) {
<a name="l00207"></a>00207             <span class="keywordflow">return</span> ($value ? '<span class="keyword">true</span>' : '<span class="keyword">false</span>');
<a name="l00208"></a>00208         } <span class="keywordflow">else</span> {
<a name="l00209"></a>00209             <span class="keywordflow">return</span> <span class="charliteral">'"'</span> . addslashes($value) .  <span class="charliteral">'"'</span>;
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jan 21 14:53:13 2010 for moc_base by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
