<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>moc_base: lib/MOC/Api/Service.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_dd14fbbbdaa65b229b5565dd5e32e554.html">lib</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a31528689d76d5b04db586865b43700e.html">MOC</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_f5c843e423d5244c3f64150d0c891f4b.html">Api</a></div>
<h1>Service.php</h1><a href="Service_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00011"></a><a class="code" href="classMOC__Api__Service.html">00011</a> <span class="keyword">class </span><a class="code" href="classMOC__Api__Service.html">MOC_Api_Service</a> {
<a name="l00017"></a><a class="code" href="classMOC__Api__Service.html#de06328cbb3c01df065808197ce495e3">00017</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classMOC__Api__Service.html#de06328cbb3c01df065808197ce495e3">$instances</a> = array();
<a name="l00018"></a>00018 
<a name="l00024"></a><a class="code" href="classMOC__Api__Service.html#ebcd9a9630104dbaf880bc67987e651f">00024</a>     <span class="keyword">protected</span> <a class="code" href="classMOC__Api__Service.html#ebcd9a9630104dbaf880bc67987e651f">$services</a> = array();
<a name="l00025"></a>00025 
<a name="l00032"></a><a class="code" href="classMOC__Api__Service.html#fdec1a1524702ad32df22a41d0b93539">00032</a>     <span class="keyword">public</span> function <span class="keyword">register</span>($name, $Object) {
<a name="l00033"></a>00033         <span class="keywordflow">if</span> (!is_object($Object)) {
<a name="l00034"></a>00034             $Object = <span class="keyword">new</span> $Object();
<a name="l00035"></a>00035         }
<a name="l00036"></a>00036 
<a name="l00037"></a>00037         <span class="keywordflow">if</span> (!($Object instanceof <a class="code" href="interfaceMOC__Api__Service__Interface.html">MOC_Api_Service_Interface</a>)) {
<a name="l00038"></a>00038             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classMOC__Api__Service__Exception.html">MOC_Api_Service_Exception</a>(sprintf('Object %s does not implement MOC_Api_Service_Interface', get_class($Object)));
<a name="l00039"></a>00039         }
<a name="l00040"></a>00040 
<a name="l00041"></a>00041         <span class="keywordflow">if</span> (array_key_exists($name, $this-&gt;services)) {
<a name="l00042"></a>00042             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classMOC__Api__Exception.html">MOC_Api_Exception</a>(sprintf('The service <span class="stringliteral">"%s"</span> has already been registered', $name));
<a name="l00043"></a>00043         }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         $this-&gt;services[$name] = $Object;
<a name="l00046"></a>00046     }
<a name="l00047"></a>00047 
<a name="l00053"></a><a class="code" href="classMOC__Api__Service.html#3e5bf8c7279efbbc5fd343e7a659c8c2">00053</a>     <span class="keyword">public</span> function <a class="code" href="classMOC__Api__Service.html#3e5bf8c7279efbbc5fd343e7a659c8c2">unregister</a>($name) {
<a name="l00054"></a>00054         <span class="keywordflow">if</span> (!array_key_exists($name, $this-&gt;services)) {
<a name="l00055"></a>00055             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classMOC__Api__Exception.html">MOC_Api_Exception</a>(sprintf('The service <span class="stringliteral">"%s"</span> has not been registered', $name));
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057         unset($this-&gt;services[$name]);
<a name="l00058"></a>00058     }
<a name="l00059"></a>00059 
<a name="l00067"></a><a class="code" href="classMOC__Api__Service.html#7f2f5d63bbf172e68a3caeb3503a3c64">00067</a>     <span class="keyword">public</span> function <a class="code" href="classMOC__Api__Service.html#7f2f5d63bbf172e68a3caeb3503a3c64">invoke</a>($method = null, $params = null) {
<a name="l00068"></a>00068         <span class="keywordflow">if</span> (empty($method) || !is_string($method)) {
<a name="l00069"></a>00069             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classMOC__Api__Service__Exception.html">MOC_Api_Service_Exception</a>('Missing or invalid <span class="stringliteral">"method"</span> parameter');
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         foreach ($this-&gt;services as $name =&gt; $Object) {
<a name="l00073"></a>00073             <span class="keywordflow">if</span> ($Object-&gt;provides($method)) {
<a name="l00074"></a>00074                 $return = $Object-&gt;invoke($method, $params);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076                 <span class="comment">// Check if the return value is empty</span>
<a name="l00077"></a>00077                 <span class="keywordflow">if</span> (is_null($return)) {
<a name="l00078"></a>00078                     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classMOC__Api__Exception.html">MOC_Api_Exception</a>(sprintf('API method <span class="stringliteral">"%s"</span> from object <span class="stringliteral">"%s"</span> did not <span class="keywordflow">return</span> any data', $method, get_class($Object)));
<a name="l00079"></a>00079                 }
<a name="l00080"></a>00080                 <span class="keywordflow">return</span> $return;
<a name="l00081"></a>00081             }
<a name="l00082"></a>00082         }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classMOC__Api__Service__Exception.html">MOC_Api_Service_Exception</a>(sprintf('No API services provide the method <span class="stringliteral">"%s"</span>', $method));
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086 
<a name="l00091"></a><a class="code" href="classMOC__Api__Service.html#fb00d94ace36470d7d7746b68e293ed3">00091</a>     <span class="keyword">protected</span> function <a class="code" href="classMOC__Api__Service.html#fb00d94ace36470d7d7746b68e293ed3">__construct</a>() {
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094 
<a name="l00100"></a><a class="code" href="classMOC__Api__Service.html#69d13713857d031a83d0992f431fb4bb">00100</a>     <span class="keyword">public</span> function <a class="code" href="classMOC__Api__Service.html#69d13713857d031a83d0992f431fb4bb">__clone</a>() {
<a name="l00101"></a>00101         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classMOC__Api__Exception.html">MOC_Api_Exception</a>(sprintf('Your not allowed to clone <span class="keyword">this</span> object (%s))', get_class($this)));
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00110"></a><a class="code" href="classMOC__Api__Service.html#0ebabd8783935f52130f9ea38cd79a69">00110</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classMOC__Api__Service.html#0ebabd8783935f52130f9ea38cd79a69">getInstance</a>($name = '<span class="keywordflow">default</span>') {
<a name="l00111"></a>00111         <span class="keywordflow">if</span> (!array_key_exists($name, self::$instances)) {
<a name="l00112"></a>00112             self::$instances[$name] = <span class="keyword">new</span> <a class="code" href="classMOC__Api__Service.html">MOC_Api_Service</a>();
<a name="l00113"></a>00113         }
<a name="l00114"></a>00114         <span class="keywordflow">return</span> self::$instances[$name];
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jan 21 14:53:13 2010 for moc_base by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
